<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Emotion AI</title>
<style>
    /* --- GLOBAL LAYOUT --- */
    body {
        margin: 0;
        background: radial-gradient(circle at center, #1e293b 0%, #020617 100%);
        color: white;
        font-family: 'Segoe UI', sans-serif;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        overflow: hidden; /* Prevent scrollbars */
    }

    /* Floating Title */
    h2 {
        margin-bottom: 40px;
        font-weight: 300;
        letter-spacing: 4px;
        text-transform: uppercase;
        color: #38bdf8;
        animation: fadeInDown 1s ease-out;
    }

    /* --- FLEX CONTAINER (Centers the panels) --- */
    .container {
        display: flex;
        gap: 50px;
        align-items: center;
        justify-content: center;
        flex-wrap: wrap; /* Stacks on mobile */
        animation: zoomIn 0.8s ease-out;
    }

    /* --- VIDEO PANEL (Left) --- */
    .video-box {
        position: relative;
        width: 320px;
        height: 320px;
        border-radius: 24px;
        overflow: hidden;
        border: 4px solid #334155;
        box-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
        transition: border-color 0.3s ease;
    }

    /* Glowing Pulse Animation */
    .video-box::after {
        content: "";
        position: absolute;
        top: -4px; left: -4px; right: -4px; bottom: -4px;
        border-radius: 24px;
        border: 2px solid transparent;
        animation: borderPulse 3s infinite;
        pointer-events: none;
    }

    video {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transform: scaleX(-1); /* Mirror effect */
    }

    canvas {
        position: absolute;
        top: 0; left: 0;
        width: 100%; height: 100%;
        transform: scaleX(-1); /* Mirror bounding box too */
    }

    /* --- RESULT PANEL (Right) --- */
    .panel {
        width: 300px;
        background: rgba(30, 41, 59, 0.7); /* Glassmorphism */
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 24px;
        padding: 30px;
        text-align: center;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
        
        /* Smooth transition for color changes */
        transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* Happy State (Green Glow) */
    .panel.happy-mode {
        background: rgba(6, 78, 59, 0.8);
        border-color: #34d399;
        box-shadow: 0 0 50px rgba(52, 211, 153, 0.3);
        transform: scale(1.05); /* Slight pop */
    }

    .emoji-box {
        font-size: 90px;
        margin-bottom: 10px;
        filter: drop-shadow(0 10px 10px rgba(0,0,0,0.3));
        animation: float 3s ease-in-out infinite;
    }

    .info-item {
        margin: 15px 0;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px solid rgba(255,255,255,0.1);
        padding-bottom: 5px;
    }

    .label { color: #94a3b8; font-size: 0.9rem; }
    .value { font-size: 1.2rem; font-weight: bold; color: #f1f5f9; }

    #reply {
        margin-top: 25px;
        padding: 15px;
        background: rgba(0, 0, 0, 0.2);
        border-radius: 12px;
        font-style: italic;
        color: #7dd3fc;
        min-height: 40px;
    }

    /* --- ANIMATIONS --- */
    @keyframes fadeInDown {
        from { opacity: 0; transform: translateY(-20px); }
        to { opacity: 1; transform: translateY(0); }
    }

    @keyframes zoomIn {
        from { opacity: 0; transform: scale(0.9); }
        to { opacity: 1; transform: scale(1); }
    }

    @keyframes float {
        0%, 100% { transform: translateY(0px); }
        50% { transform: translateY(-10px); }
    }

    @keyframes borderPulse {
        0% { box-shadow: 0 0 0 0 rgba(56, 189, 248, 0.4); }
        70% { box-shadow: 0 0 0 15px rgba(56, 189, 248, 0); }
        100% { box-shadow: 0 0 0 0 rgba(56, 189, 248, 0); }
    }

</style>
</head>
<body>

    <h2>Emotion Recognition AI</h2>

    <div class="container">
        
        <div class="video-box">
            <video id="video" autoplay playsinline muted></video>
            <canvas id="overlay"></canvas>
        </div>

        <div class="panel" id="resultPanel">
            <div id="emoji" class="emoji-box">ðŸ¤–</div>
            
            <div class="info-item">
                <span class="label">Detected</span>
                <span id="emotion" class="value">Scanning...</span>
            </div>

            <div class="info-item">
                <span class="label">Confidence</span>
                <span id="confidence" class="value">--%</span>
            </div>

            <div id="reply">"Initializing system..."</div>
        </div>

    </div>

    <canvas id="captureCanvas" width="320" height="320" style="display:none;"></canvas>

<script>
    const video = document.getElementById("video");
    const overlay = document.getElementById("overlay");
    const ctx = overlay.getContext("2d");
    const resultPanel = document.getElementById("resultPanel");
    
    // Capture canvas
    const captureCanvas = document.getElementById("captureCanvas");
    const captureCtx = captureCanvas.getContext("2d");

    // 1. Setup Camera
    navigator.mediaDevices.getUserMedia({ video: { width: 320, height: 320 } })
        .then(stream => video.srcObject = stream)
        .catch(err => {
            console.error(err);
            document.getElementById("reply").innerText = "Camera Access Denied";
        });

    // 2. Main Loop
    async function updateLoop() {
        if (!video.videoWidth) {
            requestAnimationFrame(updateLoop);
            return;
        }

        // Draw video frame to hidden canvas for sending
        captureCtx.drawImage(video, 0, 0, 320, 320);
        const imgData = captureCanvas.toDataURL("image/jpeg", 0.6);

        try {
            // Send to Python Backend
            const res = await fetch("/predict", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ image: imgData })
            });
            const data = await res.json();

            // Update Text
            document.getElementById("emoji").innerText = data.emoji || "ðŸ¤”";
            document.getElementById("emotion").innerText = data.emotion || "Scanning";
            document.getElementById("confidence").innerText = (data.confidence || 0) + "%";
            document.getElementById("reply").innerText = data.reply || "...";

            // Update Panel Style (Happy Mode)
            if (data.emotion === "Happy") {
                resultPanel.classList.add("happy-mode");
            } else {
                resultPanel.classList.remove("happy-mode");
            }

            // Draw Face Box
            // Clear previous drawing
            ctx.clearRect(0, 0, 320, 320);
            
            if (data.face) {
                const [x, y, w, h] = data.face;
                
                // Box Styling
                ctx.strokeStyle = (data.emotion === "Happy") ? "#34d399" : "#38bdf8";
                ctx.lineWidth = 4;
                
                // Draw rounded rect (simulated)
                ctx.strokeRect(x, y, w, h);
                
                // Add a glow effect to the box lines
                ctx.shadowBlur = 10;
                ctx.shadowColor = (data.emotion === "Happy") ? "#34d399" : "#38bdf8";
            } else {
                ctx.shadowBlur = 0;
            }

        } catch (error) {
            console.error(error);
        }

        // Repeat every 200ms
        setTimeout(updateLoop, 200);
    }

    updateLoop();
</script>

</body>
</html>
