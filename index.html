<!DOCTYPE html>
<html>
<head>
  <title>Live Emotion Detection</title>
  <style>
    body { font-family: Arial; text-align: center; }
    canvas { border: 2px solid #444; }
  </style>
</head>
<body>

<h2>Live Webcam Emotion Detection</h2>

<video id="video" width="320" height="320" autoplay></video>
<canvas id="canvas" width="320" height="320"></canvas>

<h3 id="emotion"></h3>
<p id="reply"></p>

<script>
  const video = document.getElementById("video");
  const canvas = document.getElementById("canvas");
  const ctx = canvas.getContext("2d");

  // Open webcam
  navigator.mediaDevices.getUserMedia({ video: true })
    .then(stream => video.srcObject = stream)
    .catch(err => alert("Camera error: " + err));

  async function sendFrame() {
    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
    const image = canvas.toDataURL("image/jpeg");

    const res = await fetch("/predict", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ image })
    });

    const data = await res.json();

    // Redraw frame
    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

    if (data.face) {
      const { x, y, w, h } = data.face;

      // Draw bounding box
      ctx.strokeStyle = "lime";
      ctx.lineWidth = 3;
      ctx.strokeRect(x, y, w, h);

      // Draw emotion + confidence
      ctx.fillStyle = "lime";
      ctx.font = "16px Arial";
      ctx.fillText(
        `${data.emotion} (${data.confidence}%)`,
        x,
        y - 10
      );

      document.getElementById("emotion").innerText =
        "Emotion: " + data.emotion;
      document.getElementById("reply").innerText =
        data.reply + " | Confidence: " + data.confidence + "%";
    }
  }

  setInterval(sendFrame, 2000); // every 2 seconds
</script>

</body>
</html>
